<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BananaPuck Dashboard</title>

    <!-- Leaflet CSS for map -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <!-- Chart.js for history trends -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f7f7f7; /* very light grey */
            color: #333;
        }

        header {
            background-color: #fff7b3; /* pastel yellow */
            padding: 16px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
        }

        #map {
            height: 320px;
            width: 100%;
        }

        .layout {
            padding: 16px;
        }

        .alerts-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 4px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .alerts-label {
            font-size: 16px;
            font-weight: bold;
        }

        .alerts-controls {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .alert-box {
            border-radius: 10px;
            padding: 10px 12px;
            margin-bottom: 10px;
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .alert-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .alert-title {
            font-weight: bold;
        }

        .alert-times {
            font-size: 13px;
            color: #555;
        }

        .alert-ok {
            background: #e5ffe7;
            border: 1px solid #8bc34a;
            color: #2e7d32;
        }

        .alert-warning {
            background: #fff8e1;
            border: 1px solid #ffb300;
            color: #ff6f00;
        }

        .alert-critical {
            background: #ffebee;
            border: 1px solid #e53935;
            color: #b71c1c;
        }

        .call-btn {
            background: #ffca28;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .clear-btn {
            background: #e0e0e0;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .alerts-mode-btn {
            background: #ffffff;
            border-radius: 6px;
            border: 1px solid #ccc;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
        }

        .alerts-mode-btn.selected {
            border-color: #ffca28;
            background: #fff7d1;
            font-weight: bold;
        }

        .dismiss-btn {
            border: none;
            background: transparent;
            font-size: 18px;
            cursor: pointer;
            line-height: 1;
            margin-left: 8px;
        }

        .grid-section-title {
            margin: 12px 4px 6px;
            font-size: 16px;
            font-weight: bold;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
        }

        .sensor-box {
            background: #fff;
            border: 1px solid #fff7b3;
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            cursor: pointer;
        }

        .sensor-box h3 {
            margin: 0 0 6px 0;
            font-size: 15px;
        }

        .sensor-box p {
            margin: 0;
            font-size: 18px;
        }

        .small {
            font-size: 13px;
            color: #666;
        }

        /* Card state colors */
        .card-ok {
            border-color: #c8e6c9;
            background: #f1fff2;
        }

        .card-warning {
            border-color: #ffecb3;
            background: #fff8e1;
        }

        .card-critical {
            border-color: #ef9a9a;
            background: #ffebee;
        }

        .audio-section {
            margin-top: 24px;
        }

        .audio-item {
            background: #fff;
            border-radius: 8px;
            padding: 8px 10px;
            margin-bottom: 8px;
            border: 1px solid #eee;
        }

        /* Modal for history */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: #fff;
            border-radius: 10px;
            max-width: 900px;
            width: 90%;
            max-height: 90%;
            overflow: auto;
            padding: 16px 18px;
        }

        .modal-header {
            display: flex;
            justify-content: space_between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
        }

        .close-btn {
            cursor: pointer;
            font-size: 22px;
            line-height: 22px;
            border: none;
            background: none;
        }

        .modal-controls {
            margin: 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 6px 8px;
            text-align: left;
        }

        th {
            background: #f7f7f7;
        }
    </style>
</head>
<body>
    <header>BananaPuck Live Dashboard</header>

    <div id="map"></div>

    <div class="layout">

        <!-- ALERTS SECTION -->
        <div class="alerts-header-row">
            <div class="alerts-label">Alerts</div>
            <div class="alerts-controls">
                <button id="activeAlertsBtn" class="alerts-mode-btn selected">Active</button>
                <button id="historyAlertsBtn" class="alerts-mode-btn">History</button>
                <button id="clearAlertsBtn" class="clear-btn">Clear Active</button>
                <button id="callUserBtn" class="call-btn">Call User (Vibrate)</button>
            </div>
        </div>
        <div id="alertsContainer"></div>

        <!-- VITALS -->
        <div class="grid-section-title">Vitals</div>
        <div class="grid">
            <div class="sensor-box vital-card" data-metric="hr" data-label="Heart Rate (bpm)">
                <h3>Heart Rate</h3>
                <p id="heartRate">-- bpm</p>
                <p class="small">Click for history</p>
            </div>

            <div class="sensor-box vital-card" data-metric="breathing" data-label="Respiration (breaths/min)">
                <h3>Respiration</h3>
                <p id="respirationRate">-- breaths/min</p>
                <p class="small">Click for history</p>
            </div>

            <div class="sensor-box vital-card" data-metric="temp" data-label="Temperature (°C)">
                <h3>Temperature</h3>
                <p id="temperature">-- °C</p>
                <p class="small">Click for history</p>
            </div>
        </div>

        <!-- MOTION -->
        <div class="grid-section-title">Motion & Orientation</div>
        <div class="grid">
            <div class="sensor-box vital-card" data-metric="orientation" data-label="Orientation">
                <h3>Orientation</h3>
                <p id="roll">Roll: --</p>
                <p id="pitch">Pitch: --</p>
                <p id="yaw">Yaw: --</p>
                <p class="small">Click for history</p>
            </div>

            <div class="sensor-box vital-card" data-metric="accel" data-label="Acceleration">
                <h3>Acceleration</h3>
                <p id="accelX">X: --</p>
                <p id="accelY">Y: --</p>
                <p id="accelZ">Z: --</p>
                <p class="small">Click for history</p>
            </div>

            <div class="sensor-box vital-card" data-metric="gyro" data-label="Gyroscope">
                <h3>Gyroscope</h3>
                <p id="gyroX">X: --</p>
                <p id="gyroY">Y: --</p>
                <p id="gyroZ">Z: --</p>
                <p class="small">Click for history</p>
            </div>
        </div>

        <!-- ENVIRONMENT / POSITION -->
        <div class="grid-section-title">Environment & Position</div>
        <div class="grid">
            <div class="sensor-box vital-card" data-metric="distance_m" data-label="LiDAR Distance (m)">
                <h3>LiDAR Distance</h3>
                <p id="lidarDist">-- m</p>
                <p class="small">Click for history</p>
            </div>

            <div class="sensor-box vital-card" data-metric="gps" data-label="GPS">
                <h3>GPS</h3>
                <p id="gpsLat">Lat: --</p>
                <p id="gpsLon">Lon: --</p>
                <p id="gpsAcc">Accuracy: -- m</p>
                <p class="small">Click for history</p>
            </div>

            <div class="sensor-box vital-card" data-metric="water_submerged" data-label="Water Submerged">
                <h3>Water</h3>
                <p id="waterSub">--</p>
                <p class="small">Click for history</p>
            </div>

            <div class="sensor-box">
                <h3>ECG</h3>
                <p id="ecgVal">--</p>
            </div>

            <div class="sensor-box">
                <h3>Last Update</h3>
                <p id="lastUpdate" class="small">--</p>
            </div>
        </div>

        <!-- AUDIO CLIPS -->
        <div class="audio-section">
            <h3>Walkie-Talkie Clips</h3>
            <div id="audioList"></div>
        </div>
    </div>

    <!-- HISTORY MODAL -->
    <div id="historyModalOverlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">History</h2>
                <button id="closeModalBtn" class="close-btn">&times;</button>
            </div>

            <div class="modal-controls">
                <label for="historyWindow">Time window:</label>
                <select id="historyWindow">
                    <option value="12">Last 12 hours</option>
                    <option value="24">Last day</option>
                    <option value="168">Last week</option>
                    <option value="720">Last month</option>
                </select>
            </div>

            <canvas id="historyChart" height="120"></canvas>

            <table id="historyTable">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Your JS -->
    <script src="app.js"></script>
</body>
</html>
