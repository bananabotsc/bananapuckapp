<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BananaPuck Caregiver Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        body { font-family: Arial; margin: 0; padding: 0; background: #f0f2f5; }
        header { padding: 20px; text-align: center; background: #4CAF50; color: white; font-size: 24px; }
        #map { height: 400px; width: 100%; margin-bottom: 20px; }
        .vitals { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .vital { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); width: 150px; text-align: center; }
        #walkie { text-align: center; margin-bottom: 40px; }
        button { padding: 15px 25px; font-size: 18px; border: none; border-radius: 10px; background: #4CAF50; color: white; cursor: pointer; }
        button:active { background: #45a049; }
    </style>
</head>
<body>
    <header>BananaPuck Caregiver Dashboard</header>

    <div id="map"></div>

    <div class="vitals">
        <div class="vital">Heart Rate<br><span id="heart_rate">--</span> bpm</div>
        <div class="vital">Respiration<br><span id="respiration_rate">--</span> /min</div>
        <div class="vital">Temp<br><span id="temperature">--</span> Â°C</div>
        <div class="vital">Submerged<br><span id="submerged">--</span></div>
    </div>

    <div id="walkie">
        <button id="talkButton">Hold to Talk</button>
        <p>Status: <span id="talkStatus">Idle</span></p>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([37.422, -122.084], 18);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
        const marker = L.marker([37.422, -122.084]).addTo(map);

        async function fetchData() {
            const res = await fetch('http://10.0.0.75:5000/get_data');
            const data = await res.json();

            // Update vitals
            document.getElementById('heart_rate').innerText = data.heart_rate || '--';
            document.getElementById('respiration_rate').innerText = data.respiration_rate || '--';
            document.getElementById('temperature').innerText = data.temperature || '--';
            document.getElementById('submerged').innerText = data.submerged ? 'Yes' : 'No';

            // Update map
            if (data.location && data.location.lat && data.location.lon) {
                marker.setLatLng([data.location.lat, data.location.lon]);
                map.setView([data.location.lat, data.location.lon]);
            }
        }

        setInterval(fetchData, 1000);

        // Walkie-talkie simulation
        const talkButton = document.getElementById('talkButton');
        const talkStatus = document.getElementById('talkStatus');
        let talking = false;

        talkButton.addEventListener('mousedown', () => {
            talking = true;
            talkStatus.innerText = 'Recording...';
        });
        talkButton.addEventListener('mouseup', () => {
            talking = false;
            talkStatus.innerText = 'Idle';
            // For simulation, send dummy audio to server
            fetch('http://10.0.0.75:5000/walkie', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({audio_bytes: Array(100).fill(0)})
            });
        });
    </script>
</body>
</html>
